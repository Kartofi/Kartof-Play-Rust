<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kartof Play | Player</title>
    <link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />
    <link
      href="https://unpkg.com/videojs-http-source-selector@1.1.5/dist/videojs-http-source-selector.css"
      rel="stylesheet"
    />
    <link
      href="https://unpkg.com/@videojs/themes@1/dist/forest/index.css"
      rel="stylesheet"
    />
  </head>
  <style>
    #player {
      width: 100vw;
      height: 100vh;
    }
    body {
      margin: 0px;
    }
    /*.video-js .vjs-control-bar {
      background-color: rgba(85, 33, 134, 0.699);
    }
    .vjs-menu-button-popup .vjs-menu {
      background-color: rgba(85, 33, 134, 0.699);
      border-top-color: rgba(85, 33, 134, 0.699);
    } */
  </style>
  <body>
    <video-js
      id="player"
      class="video-js vjs-forest"
      controls
      preload="auto"
      width="640"
      height="264"
    ></video-js>

    <script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
    <script src="https://unpkg.com/videojs-contrib-quality-levels@2.1.0/dist/videojs-contrib-quality-levels.js"></script>
    <script src="https://unpkg.com/videojs-http-source-selector@1.1.5/dist/videojs-http-source-selector.min.js"></script>

    <script>
      function setCookie(name, value, days) {
        var expires = "";
        if (days) {
          var date = new Date();
          date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000);
          expires = "; expires=" + date.toUTCString();
        }
        document.cookie =
          name +
          "=" +
          (value || "") +
          expires +
          "; path=/watch/" +
          window.location.href.split("/watch/")[1];
      }

      // Function to get a cookie
      function getCookie(name) {
        var nameEQ = name + "=";
        var ca = document.cookie.split(";");
        for (var i = 0; i < ca.length; i++) {
          var c = ca[i];
          while (c.charAt(0) === " ") c = c.substring(1, c.length);
          if (c.indexOf(nameEQ) === 0)
            return c.substring(nameEQ.length, c.length);
        }
        return null;
      }
      let url = "<%= url  %>";

      url = url.replace(/&#x2F;/g, "/");

      var player = videojs("player", {
        controls: true,
        autoplay: false,
        preload: "auto",
        sources: [
          {
            src: url, // Replace this with your HLS URL
            type: "application/x-mpegURL",
          },
        ],
      });

      // Initialize the quality levels plugin
      player.qualityLevels();

      // Initialize the HTTP source selector plugin
      player.httpSourceSelector();

      // Optional: Customize the label of the selector button
      player.on("loadedmetadata", function () {
        var button = player.controlBar.getChild("HttpSourceSelector");
        if (button) {
          button.el().firstChild.firstChild.innerHTML = "Quality";
        }
      });
      // Retrieve and set the saved time from the cookie on page load
      var savedTime = getCookie("videoCurrentTime");
      if (savedTime) {
        player.currentTime(parseFloat(savedTime));
      }

      // Save the current time in the cookie whenever it updates
      player.on("timeupdate", function () {
        setCookie("videoCurrentTime", player.currentTime(), 7); // Saves for 7 days
      });

      // Optional: Clear the cookie when the video ends
      player.on("ended", function () {
        setCookie("videoCurrentTime", "", -1); // Deletes the cookie
      });
    </script>
  </body>
</html>
